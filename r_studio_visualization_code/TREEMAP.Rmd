---
title: "Total Funding by Category - Treemap"
output: html_document
date: "2025-12-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Total Funding by Category (in Millions)

This treemap visualization shows total funding by category and status.

**Required file:**
- `data/02-processed/startup_data.csv`

```{r load-packages}
library(tidyverse)
library(treemap)
library(readr)
```

```{r load-data}
# Load the dataset
startup_data <- read_csv("../data/02-processed/startup_data.csv", show_col_types = FALSE)

cat("Dataset loaded:", nrow(startup_data), "rows\n")
```

```{r prepare-data}
# Clean and prepare data
startup_clean <- startup_data %>%
  filter(!is.na(status), status != "",
         !is.na(category_code), category_code != "",
         !is.na(funding_total_usd), funding_total_usd > 0) %>%
  mutate(
    status = str_trim(as.character(status)) %>% str_to_title(),
    category_code = str_trim(as.character(category_code)) %>% 
      str_replace_all("_", " ") %>% 
      str_to_title(),
    funding_total_usd = as.numeric(funding_total_usd)
  )

treemap_data <- startup_clean %>%
  group_by(status, category_code) %>%
  summarise(
    total_funding = sum(funding_total_usd, na.rm = TRUE),
    count = n(),
    .groups = "drop"
  ) %>%
  filter(total_funding > 0) %>%
  mutate(
    funding_millions = round(total_funding / 1e6, 1),
    category_label = paste0(category_code, "\n$", funding_millions, "M")
  )
```

```{r create-treemap}
# Create treemap visualization
png("total_funding_by_category.png", 
    width = 2400, height = 1400, res = 150, bg = "white")

treemap(
  treemap_data,
  
  # Hierarchy: Status (top level) -> Category (nested)
  index = c("status", "category_label"),
  
  # Size of rectangles = total funding
  vSize = "total_funding",
  
  vColor = "status",
  type = "categorical",
  
  palette = c(
    "Acquired" = "#7CB9E8",  # Soft blue
    "Closed" = "#F5B7B1"     # Soft pink
  ),
  
  title = "Total Funding by Category (in Millions)",
  fontsize.title = 22,
  
  fontsize.labels = c(24, 13),     
  fontcolor.labels = c("white", "white"),
  fontface.labels = c(2, 1),      
  
  align.labels = list(
    c("center", "center"),  # Status centered
    c("center", "center")   # Category centered
  ),
  
  bg.labels = 200,
  
  overlap.labels = 0.7,
  
  border.col = c("white", "white"),
  border.lwds = c(10, 3),  
  
  inflate.labels = FALSE
)

dev.off()

cat("âœ“ Treemap saved as 'total_funding_by_category.png'\n\n")
```

```{r print-summary}
# Print summary statistics
cat(rep("=", 70), "\n", sep="")
cat("                    TREEMAP SUMMARY\n")
cat(rep("=", 70), "\n\n", sep="")

cat("FUNDING BY STATUS\n")
cat(rep("-", 70), "\n", sep="")
status_summary <- startup_clean %>%
  group_by(status) %>%
  summarise(
    Categories = n_distinct(category_code),
    Companies = n(),
    `Total_Funding_$M` = round(sum(funding_total_usd) / 1e6, 1),
    `Avg_Funding_$M` = round(mean(funding_total_usd) / 1e6, 2),
    .groups = "drop"
  )
print(status_summary, row.names = FALSE)

cat("\n")
cat(rep("-", 70), "\n", sep="")
cat("TOP 10 CATEGORIES BY FUNDING\n")
top_categories <- startup_clean %>%
  group_by(category_code, status) %>%
  summarise(
    Companies = n(),
    `Total_Funding_$M` = round(sum(funding_total_usd) / 1e6, 1),
    .groups = "drop"
  ) %>%
  arrange(desc(`Total_Funding_$M`)) %>%
  head(10)
print(top_categories, row.names = FALSE)

cat("\n")
cat(rep("-", 70), "\n", sep="")
cat("LARGEST TREEMAP BOXES\n")
largest_boxes <- treemap_data %>%
  arrange(desc(total_funding)) %>%
  select(status, category_code, funding_millions, count) %>%
  head(10)
names(largest_boxes) <- c("Status", "Category", "Funding_$M", "Companies")
print(largest_boxes, row.names = FALSE)
cat(rep("=", 70), "\n", sep="")
```

## How to Run This Visualization

1. Open this file in RStudio
2. Ensure the data file is in your working directory:
   - `data/02-processed/startup_data.csv`
3. Install required packages: `install.packages(c("tidyverse", "treemap", "readr"))`
4. Click "Knit" or run all code chunks to generate the visualization
