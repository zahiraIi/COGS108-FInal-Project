---
title: "Top 10 States: Startup Outcomes"
output: html_document
date: "2025-12-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Top 10 States: Startup Outcomes

This visualization shows the top 10 states by total number of startups, comparing acquired vs closed outcomes.

**Required file:**
- `data/02-processed/startup_data.csv`

```{r load-packages}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(stringr)
```

```{r load-data}
# Load the dataset
startup_data <- read_csv("../data/02-processed/startup_data.csv", show_col_types = FALSE)

cat("Dataset loaded:", nrow(startup_data), "rows\n")
```

```{r prepare-data}
# Calculate state statistics
state_stats <- startup_data %>%
  filter(!is.na(state_code), state_code != "", 
         !is.na(status), status %in% c("acquired", "closed")) %>%
  mutate(
    state_code = str_trim(toupper(as.character(state_code))),
    status = str_trim(tolower(as.character(status)))
  ) %>%
  group_by(state_code) %>%
  summarise(
    acquired = sum(status == "acquired", na.rm = TRUE),
    closed = sum(status == "closed", na.rm = TRUE),
    total = n(),
    .groups = "drop"
  ) %>%
  mutate(
    success_rate = (acquired / total) * 100
  ) %>%
  arrange(desc(total)) %>%
  head(10)  # Top 10 states

cat("Top 10 states by total startups:\n")
print(state_stats)
```

```{r create-plot}
# Prepare data for plotting
state_long <- state_stats %>%
  select(state_code, acquired, closed) %>%
  pivot_longer(cols = c(acquired, closed), 
               names_to = "outcome", 
               values_to = "count")

# Create the stacked bar chart
p2 <- ggplot(state_long, aes(x = reorder(state_code, -count), y = count, fill = outcome)) +
  geom_col(width = 0.7) +
  geom_text(data = state_stats, 
            aes(x = state_code, y = total, label = paste0(round(success_rate), "%"), fill = NULL),
            vjust = -0.5, size = 4.5, fontface = "bold", color = "gray20") +
  
  # Colors
  scale_fill_manual(
    values = c("acquired" = "#2ecc71", "closed" = "#e74c3c"),
    labels = c("Acquired", "Closed"),
    name = "Outcome"
  ) +
  
  # Labels
  labs(
    title = "Top 10 States: Startup Outcomes",
    subtitle = "Green = Acquired | Red = Closed | Percentages show acquisition rate",
    x = "State",
    y = "Number of Startups",
    caption = "States ranked by total number of startups"
  ) +
  
  # Theme
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
    legend.position = "top",
    legend.title = element_text(face = "bold", size = 12),
    axis.title = element_text(face = "bold"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    plot.background = element_rect(fill = "white", color = NA)
  )

print(p2)
```

```{r save-plot}
ggsave("top_10_states_startup_outcomes.png", p2, width = 12, height = 8, dpi = 300, bg = "white")

cat("\nâœ“ Visualization saved!\n")
cat("File: top_10_states_startup_outcomes.png\n")
```

## How to Run This Visualization

1. Open this file in RStudio
2. Ensure the data file is in your working directory:
   - `data/02-processed/startup_data.csv`
3. Install required packages: `install.packages(c("ggplot2", "dplyr", "tidyr", "readr", "stringr"))`
4. Click "Knit" or run all code chunks to generate the visualization
