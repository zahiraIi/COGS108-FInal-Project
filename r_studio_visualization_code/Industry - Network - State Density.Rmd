---
title: "Industry, Network, and State Density Visualizations"
output: html_document
date: "2025-12-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Industry, Network, and State Density Visualizations

This file creates three visualizations:
1. Success Trajectories by Industry
2. Success Trajectories by Network Strength
3. Startup Density Across America

**Required file:**
- `data/02-processed/startup_data.csv`

```{r load-packages}
library(tidyverse)
library(ggplot2)
library(scales)
library(maps)
library(viridis)
library(readr)
```

```{r load-data}
# Load the dataset
startup_data <- read_csv("../data/02-processed/startup_data.csv", show_col_types = FALSE)

cat("Dataset loaded:", nrow(startup_data), "rows\n")
```

```{r graph1-industry-success}
# Prepare data for industry success visualization
industry_success <- startup_data %>%
    filter(!is.na(funding_total_usd), funding_total_usd > 0,
           !is.na(category_code), category_code != "",
           !is.na(status), status != "") %>%
    mutate(
        category_code = str_trim(as.character(category_code)) %>% 
            str_replace_all("_", " ") %>% 
            str_to_title(),
        status = str_trim(tolower(as.character(status))),
        funding_total_usd = as.numeric(funding_total_usd),
        funding_level = case_when(
            funding_total_usd < 1e6 ~ "Lean\n<$1M",
            funding_total_usd < 5e6 ~ "Modest\n$1-5M",
            funding_total_usd < 15e6 ~ "Well-Funded\n$5-15M",
            funding_total_usd < 50e6 ~ "Heavily-Funded\n$15-50M",
            TRUE ~ "Mega-Funded\n>$50M"
        ),
        funding_level = factor(funding_level, levels = c(
            "Lean\n<$1M", "Modest\n$1-5M", "Well-Funded\n$5-15M", 
            "Heavily-Funded\n$15-50M", "Mega-Funded\n>$50M"
        ))
    )

top_cats <- industry_success %>%
    count(category_code, sort = TRUE) %>%
    head(5) %>%
    pull(category_code)

industry_funding_success <- industry_success %>%
    filter(category_code %in% top_cats) %>%
    group_by(funding_level, category_code) %>%
    summarise(
        total = n(),
        acquired = sum(status == "acquired"),
        acquisition_rate = acquired / total,
        .groups = "drop"
    ) %>%
    filter(total >= 5)

industry_funding_success <- industry_funding_success %>%
    mutate(
        category_display = case_when(
            str_detect(category_code, "Software") ~ "Software & Web",
            str_detect(category_code, "Web") ~ "Software & Web",
            str_detect(category_code, "Enterprise") ~ "Enterprise & Hardware",
            str_detect(category_code, "Hardware") ~ "Enterprise & Hardware",
            str_detect(category_code, "Biotech") ~ "Life Sciences",
            str_detect(category_code, "Games") ~ "Consumer & Media",
            str_detect(category_code, "Media") ~ "Consumer & Media",
            TRUE ~ "Other"
        )
    ) %>%
    group_by(funding_level, category_display) %>%
    summarise(
        acquired = sum(acquired),
        total = sum(total),
        .groups = "drop"
    ) %>%
    mutate(acquisition_rate = acquired / total)

p1 <- ggplot(industry_funding_success, 
             aes(x = funding_level, y = acquisition_rate, 
                 color = category_display, group = category_display,
                 size = total)) +
    geom_line(linewidth = 2) +
    geom_point(alpha = 0.8) +
    scale_y_continuous(labels = percent_format(), limits = c(0, 1)) +
    scale_size_continuous(range = c(3, 15), name = "# Companies") +
    scale_color_manual(
        values = c(
            "Consumer & Media" = "#F4B942",
            "Enterprise & Hardware" = "#2DD4BF", 
            "Life Sciences" = "#22D3EE",
            "Other" = "#A78BFA",
            "Software & Web" = "#FB7185"
        ),
        name = "Industry"
    ) +
    labs(
        title = "SUCCESS TRAJECTORIES BY INDUSTRY",
        subtitle = "How different sectors perform across funding levels",
        x = "Funding Level",
        y = "Acquisition Rate"
    ) +
    theme_dark(base_size = 14) +
    theme(
        plot.background = element_rect(fill = "#1a1a1a", color = NA),
        panel.background = element_rect(fill = "#1a1a1a", color = NA),
        panel.grid.major = element_line(color = "#333333"),
        panel.grid.minor = element_blank(),
        plot.title = element_text(color = "white", size = 20, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(color = "gray70", size = 12, hjust = 0.5),
        axis.text = element_text(color = "white"),
        axis.title = element_text(color = "white", face = "bold"),
        legend.background = element_rect(fill = "#2a2a2a", color = "gray50"),
        legend.text = element_text(color = "white"),
        legend.title = element_text(color = "white", face = "bold")
    )

print(p1)
ggsave("success_trajectories_by_industry.png", p1, width = 12, height = 8, dpi = 300, bg = "#1a1a1a")
```

```{r graph2-network-success}
# Prepare data for network strength visualization
network_success <- startup_data %>%
    filter(!is.na(relationships), relationships > 0,
           !is.na(status), status != "") %>%
    mutate(
        relationships = as.numeric(relationships),
        status = str_trim(tolower(as.character(status))),
        category_code = str_trim(as.character(category_code)) %>% 
            str_replace_all("_", " ") %>% 
            str_to_title(),
        network_level = case_when(
            relationships <= 2 ~ "Isolated\n0-2",
            relationships <= 5 ~ "Small\n3-5",
            relationships <= 10 ~ "Medium\n6-10",
            relationships <= 20 ~ "Strong\n11-20",
            TRUE ~ "Massive\n20+"
        ),
        network_level = factor(network_level, levels = c(
            "Isolated\n0-2", "Small\n3-5", "Medium\n6-10", 
            "Strong\n11-20", "Massive\n20+"
        ))
    )

top_cats_network <- network_success %>%
    count(category_code, sort = TRUE) %>%
    head(5) %>%
    pull(category_code)

network_industry_success <- network_success %>%
    filter(category_code %in% top_cats_network) %>%
    group_by(network_level, category_code) %>%
    summarise(
        total = n(),
        acquired = sum(status == "acquired"),
        acquisition_rate = acquired / total,
        .groups = "drop"
    ) %>%
    filter(total >= 5) %>%
    mutate(
        category_display = case_when(
            str_detect(category_code, "Software") ~ "Software & Web",
            str_detect(category_code, "Web") ~ "Software & Web",
            str_detect(category_code, "Enterprise") ~ "Enterprise & Hardware",
            str_detect(category_code, "Hardware") ~ "Enterprise & Hardware",
            str_detect(category_code, "Biotech") ~ "Life Sciences",
            str_detect(category_code, "Games") ~ "Consumer & Media",
            TRUE ~ "Other"
        )
    ) %>%
    group_by(network_level, category_display) %>%
    summarise(
        acquired = sum(acquired),
        total = sum(total),
        .groups = "drop"
    ) %>%
    mutate(acquisition_rate = acquired / total)

p2 <- ggplot(network_industry_success, 
             aes(x = network_level, y = acquisition_rate, 
                 color = category_display, group = category_display,
                 size = total)) +
    geom_line(linewidth = 2) +
    geom_point(alpha = 0.8) +
    scale_y_continuous(labels = percent_format(), limits = c(0, 1)) +
    scale_size_continuous(range = c(3, 15), name = "# Companies") +
    scale_color_manual(
        values = c(
            "Consumer & Media" = "#F4B942",
            "Enterprise & Hardware" = "#2DD4BF",
            "Life Sciences" = "#22D3EE",
            "Other" = "#A78BFA",
            "Software & Web" = "#FB7185"
        ),
        name = "Industry"
    ) +
    labs(
        title = "SUCCESS TRAJECTORIES BY NETWORK STRENGTH",
        subtitle = "How different sectors perform as network strength grows",
        x = "Network Strength (Relationships)",
        y = "Acquisition Rate"
    ) +
    theme_dark(base_size = 14) +
    theme(
        plot.background = element_rect(fill = "#1a1a1a", color = NA),
        panel.background = element_rect(fill = "#1a1a1a", color = NA),
        panel.grid.major = element_line(color = "#333333"),
        panel.grid.minor = element_blank(),
        plot.title = element_text(color = "white", size = 20, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(color = "gray70", size = 12, hjust = 0.5),
        axis.text = element_text(color = "white"),
        axis.title = element_text(color = "white", face = "bold"),
        legend.background = element_rect(fill = "#2a2a2a", color = "gray50"),
        legend.text = element_text(color = "white"),
        legend.title = element_text(color = "white", face = "bold")
    )

print(p2)
ggsave("success_trajectories_by_network_strength.png", p2, width = 12, height = 8, dpi = 300, bg = "#1a1a1a")
```

```{r graph3-state-density}
# Prepare data for state density map
us_states <- map_data("state")

state_lookup <- data.frame(
    state_code = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA",
                   "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
                   "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ",
                   "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC",
                   "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY", "DC"),
    state_name = tolower(c("Alabama", "Alaska", "Arizona", "Arkansas", "California", 
                           "Colorado", "Connecticut", "Delaware", "Florida", "Georgia",
                           "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", 
                           "Kentucky", "Louisiana", "Maine", "Maryland",
                           "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", 
                           "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey",
                           "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", 
                           "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina",
                           "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", 
                           "Washington", "West Virginia", "Wisconsin", "Wyoming", "District of Columbia"))
)

state_data <- startup_data %>%
    filter(!is.na(state_code), state_code != "") %>%
    mutate(state_code = str_trim(toupper(as.character(state_code)))) %>%
    group_by(state_code) %>%
    summarise(total_companies = n(), .groups = "drop") %>%
    left_join(state_lookup, by = "state_code") %>%
    filter(!is.na(state_name))

map_data_companies <- us_states %>%
    left_join(state_data, by = c("region" = "state_name"))

ca_count <- state_data %>% filter(state_code == "CA") %>% pull(total_companies)

p3 <- ggplot(map_data_companies, aes(x = long, y = lat, group = group)) +
    geom_polygon(aes(fill = total_companies), color = "white", size = 0.3) +
    coord_map("albers", lat0 = 39, lat1 = 45) +
    scale_fill_viridis(
        option = "plasma",
        name = "Number of\nStartups",
        labels = comma,
        na.value = "gray90",
        trans = "log10",
        breaks = c(1, 5, 10, 50, 100)
    ) +
    labs(
        title = "Startup Density Across America",
        subtitle = "Number of startups by state (log scale)",
        caption = paste0("California dominates with ", ca_count, " startups")
    ) +
    theme_void(base_size = 14) +
    theme(
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 13, hjust = 0.5, color = "gray40"),
        plot.caption = element_text(size = 11, hjust = 0.5, margin = margin(t = 10)),
        legend.position = "right",
        legend.title = element_text(face = "bold"),
        plot.background = element_rect(fill = "white", color = NA),
        plot.margin = margin(20, 20, 20, 20)
    )

print(p3)
ggsave("startup_density_across_america.png", p3, width = 12, height = 8, dpi = 300, bg = "white")
```

## How to Run This Visualization

1. Open this file in RStudio
2. Ensure the data file is in your working directory:
   - `data/02-processed/startup_data.csv`
3. Install required packages: `install.packages(c("tidyverse", "ggplot2", "scales", "maps", "viridis", "readr"))`
4. Click "Knit" or run all code chunks to generate the visualizations
